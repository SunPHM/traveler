<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
  	<title>traveler</title>
	<link rel="stylesheet" type="text/css" href="css/tr.css">
</head>

<body>
	<div id="ThreeJS" style="position: absolute; left:0px; top:0px"></div>
	
	<!--javascript library -->	
	<script src="js/three.js"></script>
	<script src="js/Detector.js"></script>
	<script src="js/d3.v3.min.js"></script>
        <script src="js/d3.geo.projection.v0.min.js"></script>
	
	<!--script main function -->		
	<script>
		// ThreeJS global variables for rendering the scene
		var scene, camer, renderer;
		// ThreeJS variables for showing text, a plane facing towards the camera in 3-D space 
		var canvas, context, texture, sprite;
		// when the mouse moves, call the given function
      		document.addEventListener( 'mousemove', onDocumentMouseMove, false );
		// init and animate
		initThreeJS();
		animate();
		initD3();
	
		// init D3
		function initD3(){
			var width = window.innerWidth, height = window.innerHeight;	
			// create a svg graphic to show the maps of countries
			var svg = d3.select("body").append("svg").attr("width",width).attr("height",height);
			// add a projection function to move certain map to the center of the html page
			projection = d3.geo.mercator().scale(width/6).translate([width / 2, height / 2]);
			// the path function translates GEOJson objects into svg path data
			var path = d3.geo.path().projection(projection);
			// tranform the GEOJson object into svg path data and display it into html
			d3.json("maps/USA.geo.json", function(data)
			{
				usa = svg.append("g").attr("id","usa");
				usa.selectAll("path").data(data.features).enter().append("path").attr("d",path);
			
			});	
		}
		
		//init threeJS
		function initThreeJS()
		{
			// scene
			scene = new THREE.Scene();
			// camera
			var width = window.innerWidth, height = window.innerHeight;
			var angle = 45, aspect = width / height, near = 0.1, far = 20000;
			camera = new THREE.PerspectiveCamera(angle, aspect, near, far);
			scene.add(camera);
			camera.position.set(0, height, width);
			camera.lookAt(scene.position);	
			// renderer
			if ( Detector.webgl )
				renderer = new THREE.WebGLRenderer({antialias:true});
			else
				renderer = new THREE.CanvasRenderer(); 
			renderer.setSize(width, height);
			document.body.appendChild( renderer.domElement );
			// canvas, context, texture, sprite 	
			canvas = document.createElement('canvas');
      			context = canvas.getContext('2d');
			context.font = "Bold 20px Arial";
			context.fillStyle = "rgba(0,0,0,1)";
			texture = new THREE.Texture(canvas);
			texture.needsUpdate = true;
			var spriteMaterial = new 
				THREE.SpriteMaterial({map:texture, useScreenCoordinates:true, alignment:THREE.SpriteAlignment.topLeft});	
			sprite = new THREE.Sprite(spriteMaterial);
			sprite.scale.set(200,100,1.0);
      			sprite.position.set( 50, 50, 0 ); 
			scene.add(sprite);		
		}

		// animate function using ThreeJS to render new interface
		function animate()
		{
			requestAnimationFrame(animate);
  			renderer.render(scene, camera);
		}	
		
		// capture mouse movement and update the ThreeJS scene 	
		function onDocumentMouseMove(event) 
		{
			// update the mouse variable
			var mouse = {x:0, y:0};
			mouse.x = event.clientX;
			mouse.y = event.clientY;
			//console.log('mouse position captured: x = '  + mouse.x + ', y = ' + mouse.y);
			update(mouse);
		}
			
		// update the text to show at the mouse position	
		function update(mouse)
		{
			// x and y used for testing different languages
			var x = (mouse.x / window.innerWidth) * 2 - 1;
			var y = -(mouse.y / window.innerHeight) * 2 + 1;
			// display the message
			var message="test";		
			context.clearRect(0,0,640,480);
			var metrics = context.measureText(message);
			var width = metrics.width;
			// draw the textbox
			context.fillStyle = "rgba(0,0,0,0.95)"; // black border
            		context.fillRect( 0,0, width+20,20+8);
            		context.fillStyle = "rgba(255,255,255,0.95)"; // white filler
            		context.fillRect( 2,2, width+16,20+4 );
            		context.fillStyle = "rgba(0,0,0,1)"; // text color
            		context.fillText( message, 4,20 );
            		texture.needsUpdate = true;
			// update the textbox position
			sprite.position.set(mouse.x, mouse.y - 20, 0 );
		}
	
	</script>	
</body>
</html>
